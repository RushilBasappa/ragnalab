services:
  ntfy:
    image: binwiederhier/ntfy:latest
    container_name: ntfy
    command: serve
    volumes:
      - ntfy_data:/var/cache/ntfy
      - ./server.yml:/etc/ntfy/server.yml:ro
    networks:
      - traefik_public
    labels:
      traefik.enable: "true"
      traefik.http.routers.ntfy.rule: "Host(`ntfy.${DOMAIN}`)"
      traefik.http.routers.ntfy.entrypoints: websecure
      traefik.http.services.ntfy.loadbalancer.server.port: "80"
      kuma.ntfy.http.name: Ntfy
      kuma.ntfy.http.url: https://ntfy.${DOMAIN}/v1/health
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:80/v1/health || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          memory: 128M
    restart: unless-stopped

volumes:
  ntfy_data:
    external: true

networks:
  traefik_public:
    external: true
