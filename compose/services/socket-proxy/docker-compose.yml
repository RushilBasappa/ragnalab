services:
  socket-proxy:
    image: tecnativa/docker-socket-proxy:latest
    container_name: socket-proxy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      # Allow (read-only, what Traefik needs)
      CONTAINERS: 1
      NETWORKS: 1
      SERVICES: 1
      TASKS: 1
      EVENTS: 1
      PING: 1
      VERSION: 1
      # Deny everything else
      POST: 0
      AUTH: 0
      SECRETS: 0
      CONFIGS: 0
      DISTRIBUTIONS: 0
      IMAGES: 1
      INFO: 1
      MODULES: 0
      NODES: 0
      PLUGINS: 0
      SESSION: 0
      SWARM: 0
      SYSTEM: 0
      VOLUMES: 0
      BUILD: 0
      COMMIT: 0
      EXEC: 0
      GRPC: 0
    read_only: true
    tmpfs:
      - /run
      - /tmp
    networks:
      - socket_proxy
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:2375/version || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          memory: 64M
    restart: unless-stopped

networks:
  socket_proxy:
    external: true
